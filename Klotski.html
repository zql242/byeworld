<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4x4 æ•¸å­—è¯å®¹é“ Â· ç°¡æ½”ç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            margin: 0;
            padding: 0;
        }

        body {
            background: #f0f2f5;   /* æŸ”å’Œåº•è‰²è¥¯æ‰˜ç™½è‰²å¡ç‰‡ */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', 'Noto Sans TC', 'Microsoft JhengHei', Roboto, system-ui, sans-serif;
            padding: 16px;
            margin: 0;
        }

        .game-card {
            background: white;
            width: fit-content;
            max-width: 550px;
            padding: 32px 28px 36px;
            border-radius: 42px;
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08), 0 4px 12px rgba(0, 0, 0, 0.02);
            border: 1px solid #e9e9e9;
            transition: all 0.2s;
        }

        h1 {
            text-align: center;
            margin: 0 0 24px 0;
            font-weight: 450;
            font-size: 2.2rem;
            letter-spacing: 2px;
            color: #2c3e50;
            border-bottom: 2px solid #eaeef2;
            padding-bottom: 12px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(4, 88px);
            grid-template-rows: repeat(4, 88px);
            gap: 10px;
            background: #fafafa;
            padding: 18px;
            border-radius: 28px;
            box-shadow: inset 0 0 0 1px #dddddd, 0 6px 10px rgba(0,0,0,0.02);
            margin-bottom: 24px;
        }

        .tile {
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 20px;
            font-size: 2.1rem;
            font-weight: 550;
            color: #1e2b37;
            box-shadow: 0 3px 0 #b0bec5, 0 4px 10px rgba(0, 0, 0, 0.04);
            transition: all 0.08s ease;
            cursor: pointer;
            border: 1px solid #dce4e8;
            will-change: transform;
        }

        .tile:active:not(.empty) {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #9aa9b2, 0 4px 8px rgba(0, 0, 0, 0.04);
        }

        .tile.empty {
            background: #eceff3;
            box-shadow: inset 0 0 0 1px #ccd7de, 0 2px 6px rgba(0,0,0,0.02);
            color: transparent;
            cursor: default;
            border: 1px solid #d3dee6;
        }

        .tile.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #a3cfb1;
            box-shadow: 0 3px 0 #8fbc9f, 0 4px 8px rgba(0, 0, 0, 0.04);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ffffff;
            padding: 8px 12px 8px 24px;
            border-radius: 48px;
            border: 1px solid #dee6ed;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }

        .move-badge {
            background: #f2f6f9;
            color: #1e3c5a;
            padding: 10px 26px;
            border-radius: 40px;
            font-weight: 550;
            font-size: 1.4rem;
            letter-spacing: 0.5px;
            border: 1px solid #d0ddee;
        }

        button {
            background: #e6edf6;
            border: 1px solid #bcccdb;
            padding: 10px 32px;
            border-radius: 40px;
            font-size: 1.4rem;
            font-weight: 550;
            color: #1e3b4f;
            cursor: pointer;
            box-shadow: 0 3px 0 #b0c2d2, 0 4px 8px rgba(0, 0, 0, 0.02);
            transition: 0.05s linear;
            letter-spacing: 1px;
        }

        button:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #9fb1c0, 0 4px 8px rgba(0, 0, 0, 0.02);
        }

        .win-message {
            text-align: center;
            margin-top: 20px;
            font-size: 1.9rem;
            font-weight: 550;
            color: #0e5c3f;
            background: #e1f3e7;
            padding: 10px 16px;
            border-radius: 48px;
            opacity: 0;
            transition: opacity 0.15s;
            border: 1px solid #a6d0b5;
        }

        .win-message.show {
            opacity: 1;
        }

        .footer-note {
            text-align: center;
            margin-top: 14px;
            color: #99aebb;
            font-size: 1rem;
            font-weight: 400;
        }
    </style>
</head>
<body>
    <div class="game-card">
        <h1>ğŸ•¹ï¸ 4x4 è¯å®¹é“</h1>

        <!-- æ‹¼åœ–æ£‹ç›¤ -->
        <div class="board" id="board"></div>

        <!-- åº•éƒ¨æ§åˆ¶åˆ— -->
        <div class="info-row">
            <div class="move-badge" id="moveCounter">ğŸ“ 0 æ­¥</div>
            <button id="shuffleBtn">ğŸ”„ é‡æ–°æ´—ç‰Œ</button>
        </div>

        <!-- å‹åˆ©æç¤º -->
        <div id="victoryMessage" class="win-message">âœ¨ æ­å–œéé—œï¼ âœ¨</div>
        <div class="footer-note">é»æ“Šæ•¸å­—ç§»å‹• Â· æ­¸ä½è®Šç¶ è‰²</div>
    </div>

    <script>
        (function() {
            // 4x4 è¯å®¹é“è¨­å®šï¼šæ•¸å­— 1~15ï¼Œ0 ä»£è¡¨ç©ºæ ¼
            const SIZE = 4;
            const TOTAL_CELLS = SIZE * SIZE;  // 16
            const EMPTY = 0;

            // éŠæˆ²ç‹€æ…‹
            let tiles = [];               // ä¸€ç¶­é™£åˆ—ï¼Œé †åºå¾ä¸Šåˆ°ä¸‹ã€å·¦è‡³å³
            let emptyIndex = 15;           // ç©ºæ ¼åˆå§‹ç´¢å¼• (å³ä¸‹è§’)
            let moves = 0;
            let gameWon = false;

            // DOM å…ƒç´ 
            const boardEl = document.getElementById('board');
            const moveSpan = document.getElementById('moveCounter');
            const victoryMsg = document.getElementById('victoryMessage');
            const shuffleBtn = document.getElementById('shuffleBtn');

            // åˆå§‹åŒ–å®Œæˆç‹€æ…‹ (1~15 é †åºï¼Œ0 åœ¨æœ€å¾Œ)
            function initSolvedState() {
                tiles = [];
                for (let i = 1; i < TOTAL_CELLS; i++) {
                    tiles.push(i);
                }
                tiles.push(EMPTY);          // ç´¢å¼• 15 ç‚º 0
                emptyIndex = 15;
                moves = 0;
                gameWon = true;              // ç›®å‰æ˜¯å®Œæˆç‹€æ…‹ï¼Œä½†ç¨å¾Œæ´—ç‰Œæœƒé‡è¨­
                victoryMsg.classList.remove('show');
            }
            initSolvedState();

            // æ´—ç‰Œ (å¾é‚„åŸæ…‹åŸ·è¡Œå¤§é‡éš¨æ©Ÿç§»å‹•ï¼Œä¿è­‰å¯è§£)
            function shuffleBoard(stepCount = 200) {
                // å…ˆå›åˆ°å®Œæˆæ…‹
                initSolvedState();    // tiles ç‚ºé‚„åŸæ…‹ï¼ŒgameWon = true
                gameWon = false;
                victoryMsg.classList.remove('show');

                // å››å€‹æ–¹å‘ï¼šä¸Šã€ä¸‹ã€å·¦ã€å³ (ç©ºæ ¼ç§»å‹•)
                const dirs = [
                    { dr: -1, dc: 0 }, // ä¸Š (ç©ºæ ¼å‘ä¸‹)
                    { dr: 1, dc: 0 },  // ä¸‹ (ç©ºæ ¼å‘ä¸Š)
                    { dr: 0, dc: -1 }, // å·¦ (ç©ºæ ¼å‘å³)
                    { dr: 0, dc: 1 }   // å³ (ç©ºæ ¼å‘å·¦)
                ];

                for (let step = 0; step < stepCount; step++) {
                    const emptyRow = Math.floor(emptyIndex / SIZE);
                    const emptyCol = emptyIndex % SIZE;

                    // æ”¶é›†åˆæ³•ç§»å‹•ï¼šèˆ‡ç©ºæ ¼ç›¸é„°çš„æ ¼å­ç´¢å¼•
                    const validNeighbors = [];
                    for (const d of dirs) {
                        const newRow = emptyRow + d.dr;
                        const newCol = emptyCol + d.dc;
                        if (newRow >= 0 && newRow < SIZE && newCol >= 0 && newCol < SIZE) {
                            validNeighbors.push(newRow * SIZE + newCol);
                        }
                    }

                    if (validNeighbors.length === 0) continue; // å®‰å…¨åˆ¤æ–·

                    // éš¨æ©ŸæŒ‘é¸ä¸€å€‹é„°æ ¼èˆ‡ç©ºæ ¼äº¤æ›
                    const randIdx = validNeighbors[Math.floor(Math.random() * validNeighbors.length)];
                    // äº¤æ› tiles ä¸­ç©ºæ ¼èˆ‡é„°æ ¼çš„å€¼
                    [tiles[emptyIndex], tiles[randIdx]] = [tiles[randIdx], tiles[emptyIndex]];
                    emptyIndex = randIdx;   // ç©ºæ ¼ç§»å‹•åˆ°æ–°ä½ç½®
                }

                moves = 0;
                gameWon = false;
                updateMoveCounter();
                renderBoard();
            }

            // æª¢æŸ¥æ˜¯å¦å‹åˆ© (æ‰€æœ‰æ•¸å­—é †åºæ­£ç¢ºï¼šç´¢å¼• 0~14 = 1~15ï¼Œç´¢å¼•15 = 0)
            function checkVictory() {
                for (let i = 0; i < TOTAL_CELLS - 1; i++) {
                    if (tiles[i] !== i + 1) return false;
                }
                return tiles[TOTAL_CELLS - 1] === EMPTY;
            }

            // è™•ç†é»æ“Šç§»å‹•
            function tryMove(clickedIndex) {
                if (gameWon) return false;                 // å·²é€šé—œä¸å›æ‡‰
                if (tiles[clickedIndex] === EMPTY) return false; // é»åˆ°ç©ºæ ¼ç„¡æ•ˆ

                const emptyRow = Math.floor(emptyIndex / SIZE);
                const emptyCol = emptyIndex % SIZE;
                const clickedRow = Math.floor(clickedIndex / SIZE);
                const clickedCol = clickedIndex % SIZE;

                const rowDiff = Math.abs(emptyRow - clickedRow);
                const colDiff = Math.abs(emptyCol - clickedCol);

                // ç›¸é„°æ¢ä»¶ï¼šæ›¼å“ˆé “è·é›¢ç‚º1
                if ((rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1)) {
                    // äº¤æ›ç©ºæ ¼èˆ‡é»æ“Šçš„æ•¸å­—
                    [tiles[emptyIndex], tiles[clickedIndex]] = [tiles[clickedIndex], tiles[emptyIndex]];
                    emptyIndex = clickedIndex;
                    moves++;

                    updateMoveCounter();

                    if (checkVictory()) {
                        gameWon = true;
                        victoryMsg.classList.add('show');
                    } else {
                        victoryMsg.classList.remove('show');
                    }

                    renderBoard();
                    return true;
                }
                return false;
            }

            // æ›´æ–°æ­¥æ•¸é¡¯ç¤º
            function updateMoveCounter() {
                moveSpan.innerText = `ğŸ“ ${moves} æ­¥`;
            }

            // ç¹ªè£½æ£‹ç›¤
            function renderBoard() {
                boardEl.innerHTML = '';

                tiles.forEach((value, index) => {
                    const tileDiv = document.createElement('div');
                    tileDiv.className = 'tile';

                    if (value === EMPTY) {
                        tileDiv.classList.add('empty');
                    } else {
                        tileDiv.textContent = value;
                    }

                    // æ¨™è¨˜æ­£ç¢ºä½ç½®çš„æ•¸å­— (é‡‘è‰²â†’æ”¹ç‚ºæ¸…çˆ½ç¶ è‰²)
                    if (value !== EMPTY && value === index + 1) {
                        tileDiv.classList.add('correct');
                    }

                    // ç¶å®šé»æ“Šäº‹ä»¶
                    tileDiv.addEventListener('click', (e) => {
                        e.stopPropagation();
                        tryMove(index);
                    });

                    boardEl.appendChild(tileDiv);
                });
            }

            // æ´—ç‰ŒæŒ‰éˆ•äº‹ä»¶
            shuffleBtn.addEventListener('click', () => {
                shuffleBoard(210);  // éš¨æ©Ÿæ­¥æ•¸å¤šä¸€é»è®“ç‰Œæ›´äº‚
            });

            // åˆæ¬¡å•Ÿå‹•ï¼šå…ˆé¡¯ç¤ºå®Œæˆç•«é¢0.1ç§’å†æ´—ç‰Œï¼Œè®“ä½¿ç”¨è€…çŸ¥é“åŸè²Œï¼Œä½†ç›´æ¥æ´—ç‰Œæ›´ç›´è¦º
            window.addEventListener('load', () => {
                // ç‚ºäº†è®“ä½¿ç”¨è€…é–‹å±€å°±æ˜¯å¯ç©ç‹€æ…‹ï¼Œç›´æ¥æ´—ç‰Œ
                shuffleBoard(200);
            });

            // åˆå§‹åŒ–é¡¯ç¤º
            renderBoard();
            updateMoveCounter();
        })();
    </script>
</body>
</html>