<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chanel & Rolex Â· æ¯’è—¥æ£‹å±€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .game {
            max-width: 820px;
            width: 100%;
            background: #ffffff;
            border-radius: 32px;
            padding: 24px 24px 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08), 0 0 0 2px #e9d4b0 inset;
            border: 1px solid #d4b17c;
            position: relative;
        }

        .title {
            text-align: center;
            margin-bottom: 20px;
        }
        .title h1 {
            font-size: 3.2rem;
            font-weight: 600;
            color: #3a4a55;
            letter-spacing: 2px;
            line-height: 1.2;
        }
        .title h1 span {
            color: #d4a017;
            margin: 0 8px;
        }

        .player-tags {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
            margin-bottom: 4px;
        }
        .player-tags .tag {
            font-size: 1.9rem;
            font-weight: 700;
            color: #2b4b5c;
            background: #f0ebe2;
            padding: 4px 24px;
            border-radius: 40px;
            border: 2px solid #dbb875;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .player-tags .tag.right {
            color: #2b4b5c;
            border-color: #dbb875;
        }

        .lives-row {
            display: flex;
            justify-content: space-between;
            padding: 0 20px 12px;
            font-size: 1.8rem;
        }
        .chanel-love, .rolex-love { 
            color: #d4a017; 
        }

        .boards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin: 8px 0 16px;
        }
        .board {
            background: #f8f4ed;
            border-radius: 28px;
            padding: 24px 20px 20px;
            width: 300px;
            border: 3px solid #cfaa6b;
            box-shadow: 0 6px 0 #e0c9a5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .board .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            justify-items: center;
            align-items: center;
            width: 100%;
        }
        .cell {
            width: 80px;
            height: 80px;
            background: #d9e2e8;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.4rem;
            font-weight: 600;
            color: #1d3b4a;
            box-shadow: 0 4px 0 #b2c1cc;
            border: 2px solid #9ab3c4;
            cursor: pointer;
            transition: 0.05s;
            margin: 0 auto;
        }
        .cell:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #b2c1cc;
        }
        
        .cell.disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* é™·é˜±æ¨™è¨˜ - ç´…è‰²ï¼Œä½†ä¸ç”¨æ–‡å­—èªªæ˜ */
        .cell.trap-set {
            background: #ffcdcd !important;
            border-color: #ff6b6b !important;
        }
        
        #rolexGrid .cell {
            background: #d9e2e8;
            cursor: pointer;
            opacity: 1 !important;
            color: #1d3b4a;
        }
        
        .board-footer {
            font-size: 0.95rem;
            color: #7c6846;
            background: #ede5d7;
            display: inline-block;
            padding: 4px 16px;
            border-radius: 30px;
            border: 1px solid #c5a56b;
            margin-top: 4px;
            text-align: center;
        }

        .popup-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff3e0;
            border: 3px solid #d4a017;
            border-radius: 40px;
            padding: 12px 24px;
            box-shadow: 0 6px 0 #b27d2e, 0 10px 20px rgba(0,0,0,0.15);
            z-index: 100;
            text-align: center;
            min-width: 200px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        
        .popup-message.show {
            opacity: 1;
        }
        
        .popup-message .popup-emoji {
            font-size: 2.5rem;
            margin-bottom: 2px;
        }
        
        .popup-message .popup-text {
            font-size: 1.4rem;
            font-weight: 700;
            color: #3a4a55;
            margin-bottom: 2px;
        }
        
        .popup-message .popup-sub {
            font-size: 1rem;
            color: #7c6846;
        }

        .message {
            background: #f0ebe2;
            border-radius: 40px;
            padding: 12px 20px;
            margin: 12px 0 16px;
            border: 2px solid #dbb875;
            color: #3d4f5c;
            font-size: 1.2rem;
            text-align: center;
            min-height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .actions {
            display: flex;
            gap: 16px;
            justify-content: center;
        }
        .btn {
            background: #e6dccb;
            border: none;
            color: #2f4b5c;
            font-size: 1.5rem;
            font-weight: 600;
            padding: 10px 28px;
            border-radius: 50px;
            box-shadow: 0 5px 0 #cbb99b;
            cursor: pointer;
            transition: 0.05s;
            border: 2px solid #dbb06b;
            min-width: 170px;
        }
        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #cbb99b;
        }
        .btn.reset {
            background: #ddd3c4;
            border-color: #b294d1;
            color: #3a4055;
        }

        .stage {
            text-align: center;
            margin-top: 12px;
            font-size: 1rem;
            background: #ede5d7;
            display: inline-block;
            padding: 4px 24px;
            border-radius: 30px;
            color: #7c6846;
            border: 1px solid #c5a56b;
        }
    </style>
</head>
<body>
<div class="game">
    <div class="popup-message" id="popupMessage">
        <div class="popup-emoji" id="popupEmoji">ğŸ’£</div>
        <div class="popup-text" id="popupText">ç‚¸å½ˆï¼</div>
        <div class="popup-sub" id="popupSub">æå¤± 1ğŸ’°</div>
    </div>

    <div class="title">
        <h1>Chanel <span>&</span> Rolex</h1>
    </div>

    <div class="player-tags">
        <span class="tag">ğŸ‘› Chanel</span>
        <span class="tag right">âŒš Rolex</span>
    </div>

    <div class="lives-row">
        <span class="chanel-love" id="chanelHearts">ğŸ’°ğŸ’°ğŸ’°</span>
        <span class="rolex-love" id="rolexHearts">ğŸ’°ğŸ’°ğŸ’°</span>
    </div>

    <div class="boards">
        <div class="board">
            <div class="grid" id="chanelGrid"></div>
            <div class="board-footer">ğŸ‘† ä½ çš„æ£‹ç›¤</div>
        </div>
        <div class="board">
            <div class="grid" id="rolexGrid"></div>
            <div class="board-footer">ğŸ‘† é»æ“Šå¸ƒç½®é™·é˜±</div>
        </div>
    </div>

    <div class="message" id="gameMessage">æº–å‚™éšæ®µ Â· é»ã€Œä¸‹ä¸€æ­¥ã€</div>

    <div class="actions">
        <button class="btn" id="nextBtn">â© ä¸‹ä¸€æ­¥</button>
        <button class="btn reset" id="resetBtn">ğŸ”„ é‡ä¾†</button>
    </div>

    <div class="stage" id="phaseDisplay">âš™ï¸ éšæ®µ 1/3</div>
</div>

<script>
    (function() {
        const POS = ['A1','A2','A3','B1','B2','B3','C1','C2','C3'];
        const INIT = 3;

        const BAG_EMOJI = 'ğŸ‘›';
        const WATCH_EMOJI = 'âŒš';

        const BAG_MAP = {};
        const WATCH_MAP = {};
        POS.forEach((pos) => {
            BAG_MAP[pos] = BAG_EMOJI;
            WATCH_MAP[pos] = WATCH_EMOJI;
        });

        const P1 = 'computerPoison';
        const P2 = 'humanPoison';
        const P3 = 'battle';

        let stage = P1;
        let chanelMoney = INIT, rolexMoney = INIT;
        let trapForChanel = new Set();
        let trapForRolex = new Set();
        let chanelUsed = new Set();
        let rolexUsed = new Set();
        let humanTurn = true;
        let gameOver = false;

        const chanelGrid = document.getElementById('chanelGrid');
        const rolexGrid = document.getElementById('rolexGrid');
        const msg = document.getElementById('gameMessage');
        const phaseEl = document.getElementById('phaseDisplay');
        const chanelMoneySpan = document.getElementById('chanelHearts');
        const rolexMoneySpan = document.getElementById('rolexHearts');
        const nextBtn = document.getElementById('nextBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        const popup = document.getElementById('popupMessage');
        const popupEmoji = document.getElementById('popupEmoji');
        const popupText = document.getElementById('popupText');
        const popupSub = document.getElementById('popupSub');

        function showPopup(emoji, text, sub) {
            popupEmoji.innerText = emoji;
            popupText.innerText = text;
            popupSub.innerText = sub;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 1200);
        }

        function updateMoney() {
            chanelMoneySpan.innerText = 'ğŸ’°'.repeat(chanelMoney);
            rolexMoneySpan.innerText = 'ğŸ’°'.repeat(rolexMoney);
        }

        function draw() {
            chanelGrid.innerHTML = '';
            POS.forEach(p => {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.pos = p;
                cell.dataset.board = 'chanel';
                
                let mainEmoji = BAG_MAP[p];
                if (stage === P3 && chanelUsed.has(p) && trapForChanel.has(p)) {
                    mainEmoji = 'ğŸ’£';
                } else if (stage === P3 && chanelUsed.has(p)) {
                    mainEmoji = 'âœ…';
                }
                
                cell.textContent = mainEmoji;
                
                if (stage === P3 && chanelUsed.has(p)) cell.classList.add('disabled');
                cell.style.background = '';
                chanelGrid.appendChild(cell);
            });

            rolexGrid.innerHTML = '';
            POS.forEach(p => {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.pos = p;
                cell.dataset.board = 'rolex';
                
                let mainEmoji = WATCH_MAP[p];
                
                if (stage === P2) {
                    if (trapForRolex.has(p)) {
                        cell.classList.add('trap-set');
                    } else {
                        cell.classList.remove('trap-set');
                    }
                }
                
                if (stage === P3) {
                    cell.classList.remove('trap-set');
                    if (rolexUsed.has(p) && trapForRolex.has(p)) {
                        mainEmoji = 'ğŸ’£';
                    } else if (rolexUsed.has(p)) {
                        mainEmoji = 'âœ…';
                    }
                }
                
                cell.textContent = mainEmoji;
                
                if (stage === P3) {
                    cell.style.pointerEvents = 'none';
                } else {
                    cell.style.pointerEvents = 'auto';
                }
                
                rolexGrid.appendChild(cell);
            });
        }

        function resetAll() {
            chanelMoney = INIT; rolexMoney = INIT;
            trapForChanel.clear(); trapForRolex.clear();
            chanelUsed.clear(); rolexUsed.clear();
            gameOver = false; humanTurn = true;
            stage = P1;
            updateMoney(); draw(); updateMessage();
        }

        function updateMessage() {
            if (gameOver) return;
            if (stage === P1) {
                msg.innerHTML = 'ğŸ¤– Rolex å·å·å¸ƒç½®é™·é˜± Â· é»ã€Œä¸‹ä¸€æ­¥ã€';
                phaseEl.innerText = 'âš™ï¸ éšæ®µ 1/3ï¼šé›»è…¦å¸ƒç½®';
            } else if (stage === P2) {
                msg.innerHTML = 'ğŸ™ˆ Rolex é–‰çœ¼ Â· è«‹åœ¨å³é‚Šæ£‹ç›¤é»é¸ 3 å€‹ âŒš å¸ƒç½®é™·é˜±';
                phaseEl.innerText = 'âš™ï¸ éšæ®µ 2/3ï¼šäººé¡å¸ƒç½®é™·é˜±';
            } else if (stage === P3) {
                if (humanTurn) msg.innerHTML = 'ğŸ‘› ä½ çš„å›åˆ Â· é»å·¦é‚Š ğŸ‘› é¸åŒ…åŒ…';
                else msg.innerHTML = 'âŒš é›»è…¦å›åˆ Â· æ€è€ƒä¸­';
                phaseEl.innerText = 'âš”ï¸ éšæ®µ 3/3ï¼šå°æ±º';
            }
        }

        function computerSetTrap() {
            let shuffled = [...POS];
            for (let i = shuffled.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            trapForChanel = new Set(shuffled.slice(0, 3));
        }

        function checkWin() {
            if (chanelMoney <= 0) {
                gameOver = true;
                msg.innerHTML = 'ğŸ† Rolex å‹åˆ©ï¼ Chanel ç ´ç”¢äº† ğŸ’¸';
                phaseEl.innerText = 'ğŸ’€ éŠæˆ²çµæŸ';
                return true;
            } else if (rolexMoney <= 0) {
                gameOver = true;
                msg.innerHTML = 'ğŸ† Chanel å‹åˆ©ï¼ Rolex ç ´ç”¢äº† ğŸ’¸';
                phaseEl.innerText = 'ğŸ‰ éŠæˆ²çµæŸ';
                return true;
            }
            return false;
        }

        function computerMove() {
            if (gameOver || stage !== P3 || humanTurn) return;

            let available = POS.filter(p => !rolexUsed.has(p));
            if (available.length === 0) return;

            let pick = available[Math.floor(Math.random() * available.length)];
            rolexUsed.add(pick);

            let trapped = trapForRolex.has(pick);
            if (trapped) {
                rolexMoney--;
                showPopup('ğŸ’£', 'ç‚¸å½ˆï¼', 'æå¤± 1ğŸ’°');
                msg.innerHTML = `âŒš Rolex é¸äº† âŒš Â· ğŸ’£ ç‚¸å½ˆï¼æå¤± 1ğŸ’°<br>ğŸ’° é‚„å‰© ${rolexMoney} æ¬¡æ©Ÿæœƒ`;
            } else {
                showPopup('âœ…', 'å¹³å®‰éé—œ', '');
                msg.innerHTML = `âŒš Rolex é¸äº† âŒš Â· âœ… å¹³å®‰éé—œ<br>ğŸ’° é‚„å‰© ${rolexMoney} æ¬¡æ©Ÿæœƒ`;
            }

            draw();
            updateMoney();

            if (checkWin()) { draw(); return; }

            humanTurn = true;
            updateMessage();
        }

        function handleBoardClick(e) {
            let cell = e.target.closest('.cell');
            if (!cell) return;
            if (gameOver) { 
                msg.innerHTML = 'â›” éŠæˆ²çµæŸ Â· æŒ‰é‡ä¾†';
                return;
            }

            let board = cell.dataset.board;
            let pos = cell.dataset.pos;

            if (stage === P1) {
                msg.innerHTML = 'â³ å…ˆé»ã€Œä¸‹ä¸€æ­¥ã€è®“é›»è…¦å¸ƒç½®';
                return;
            }

            if (stage === P2) {
                if (board !== 'rolex') {
                    msg.innerHTML = 'âŒ è«‹é»å³é‚Š (Rolex çš„æ£‹ç›¤) å¸ƒç½®é™·é˜±';
                    return;
                }
                if (trapForRolex.size >= 3) {
                    msg.innerHTML = 'âœ… å·²é¸æ»¿ 3 å€‹é™·é˜± Â· é»ã€Œä¸‹ä¸€æ­¥ã€';
                    return;
                }
                if (trapForRolex.has(pos)) {
                    msg.innerHTML = 'âš ï¸ å·²ç¶“é¸éäº†';
                    return;
                }
                trapForRolex.add(pos);
                cell.classList.add('trap-set');
                msg.innerHTML = `ğŸ“ é™·é˜±è¨­ç½® (${trapForRolex.size}/3) çµ¦ Rolex`;
                if (trapForRolex.size === 3) {
                    msg.innerHTML = 'ğŸ¯ é™·é˜±å®Œæˆ Â· é»ã€Œä¸‹ä¸€æ­¥ã€å°æ±º';
                }
                return;
            }

            if (stage === P3) {
                if (!humanTurn) {
                    msg.innerHTML = 'âŒš é›»è…¦å›åˆä¸­';
                    return;
                }
                if (board !== 'chanel') {
                    msg.innerHTML = 'âŒ åªèƒ½é»è‡ªå·±çš„æ£‹ç›¤ (å·¦é‚Š)';
                    return;
                }
                if (chanelUsed.has(pos)) {
                    msg.innerHTML = 'âŒ› å·²ç¶“é¸é';
                    return;
                }

                chanelUsed.add(pos);
                let trapped = trapForChanel.has(pos);

                if (trapped) {
                    chanelMoney--;
                    showPopup('ğŸ’£', 'ç‚¸å½ˆï¼', 'æå¤± 1ğŸ’°');
                    msg.innerHTML = `ğŸ‘› ä½ é¸äº† ğŸ‘› Â· ğŸ’£ ç‚¸å½ˆï¼æå¤± 1ğŸ’°<br>ğŸ’° é‚„å‰© ${chanelMoney} æ¬¡æ©Ÿæœƒ`;
                } else {
                    showPopup('âœ…', 'å¹³å®‰éé—œ', '');
                    msg.innerHTML = `ğŸ‘› ä½ é¸äº† ğŸ‘› Â· âœ… å¹³å®‰éé—œ<br>ğŸ’° é‚„å‰© ${chanelMoney} æ¬¡æ©Ÿæœƒ`;
                }

                draw();
                updateMoney();

                if (checkWin()) { draw(); return; }

                humanTurn = false;
                updateMessage();

                setTimeout(() => {
                    if (!gameOver && stage === P3 && !humanTurn) computerMove();
                }, 600);
            }
        }

        function nextStep() {
            if (gameOver) { resetAll(); return; }

            if (stage === P1) {
                computerSetTrap();
                stage = P2;
                draw();
                updateMessage();
                msg.innerHTML = 'ğŸ™ˆ æ›ä½ å¸ƒç½® Â· åœ¨å³é‚Šæ£‹ç›¤é¸ 3 å€‹ âŒš ç•¶é™·é˜±';
            }
            else if (stage === P2) {
                if (trapForRolex.size !== 3) {
                    msg.innerHTML = `âš ï¸ é‚„éœ€è¦ ${3 - trapForRolex.size} å€‹é™·é˜± (é»å³é‚Š)`;
                    return;
                }
                stage = P3;
                humanTurn = true;
                draw();
                updateMessage();
            }
            else if (stage === P3) {
                msg.innerHTML = humanTurn ? 'ğŸ‘› è«‹é»å·¦é‚Š ğŸ‘›' : 'âŒš é›»è…¦æ€è€ƒä¸­';
            }
        }

        document.querySelector('.boards').addEventListener('click', handleBoardClick);
        nextBtn.addEventListener('click', nextStep);
        resetBtn.addEventListener('click', resetAll);

        resetAll();
    })();
</script>
</body>
</html>